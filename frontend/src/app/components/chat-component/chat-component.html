<div class="chat-container">
  <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
  <div class="status" [class.connected]="isConnected()" [class.disconnected]="!isConnected()">
    {{ isConnected() ? '‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '‚úó –û—Ç–∫–ª—é—á–µ–Ω–æ' }}
    @if (!isConnected()) {
      <button (click)="reconnect()" class="reconnect-btn">–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    }
  </div>

  <!-- –û—à–∏–±–∫–∏ -->
  @if (error()) {
    <div class="error-message">
      <span>{{ error() }}</span>
      <button (click)="clearError()" class="close-btn">√ó</button>
    </div>
  }

  <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ -->
  @if (!currentUser()) {
    <div class="login-screen">
      <div class="login-card">
        <div class="login-header">
          <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç!</h2>
          <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
        </div>
        
        <div class="input-group">
          <input 
            type="text" 
            [ngModel]="username()" 
            (ngModelChange)="username.set($event)"
            placeholder="–í–∞—à–µ –∏–º—è..."
            maxlength="20"
            (keyup.enter)="setUsername()"
            class="username-input"
            autocomplete="off"
          >
          <button 
            (click)="setUsername()" 
            [disabled]="!username().trim()"
            class="join-button"
          >
            –í–æ–π—Ç–∏ –≤ —á–∞—Ç
          </button>
        </div>
      </div>
    </div>
  } @else {
    <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
    <div class="chat-screen">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
      <div class="chat-header">
        <div class="header-content">
          <h2>–ß–∞—Ç –∫–æ–º–Ω–∞—Ç—ã</h2>
          <div class="header-actions">
            <div class="user-info">
              <span class="user-name">{{ currentUser() }}</span>
              <span class="online-count">‚Ä¢ –û–Ω–ª–∞–π–Ω: {{ activeUsers().length }}</span>
            </div>
            <button (click)="logout()" class="logout-btn" title="–í—ã–π—Ç–∏ –∏–∑ —á–∞—Ç–∞">
              –í—ã–π—Ç–∏
            </button>
          </div>
        </div>
      </div>

      <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
      <div #messagesContainer class="messages-container">
        @for (msg of messages(); track trackByMessage($index, msg)) {
          <div class="message" [class.system]="msg.username === 'System'">
            @if (msg.username === 'System') {
              <div class="system-message">
                <span class="message-text">{{ msg.message }}</span>
                <span class="message-time">{{ formatTimestamp(msg.timestamp) }}</span>
              </div>
            } @else {
              <div class="user-message" [class.own-message]="msg.username === currentUser()">
                <div class="message-header">
                  <span class="username">{{ msg.username }}</span>
                  <span class="time">{{ formatTimestamp(msg.timestamp) }}</span>
                </div>
                <div class="message-content">{{ msg.message }}</div>
              </div>
            }
          </div>
        }
        
        @if (messages().length === 0) {
          <div class="empty-state">
            <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
            <span>–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</span>
          </div>
        }
      </div>

      <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è -->
      <div class="message-input-container">
        <input 
          type="text" 
          [ngModel]="message()" 
          (ngModelChange)="message.set($event)"
          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          maxlength="500"
          (keyup.enter)="sendMessage()"
          class="message-input"
          autocomplete="off"
        >
        <button 
          (click)="sendMessage()" 
          [disabled]="!message().trim()"
          class="send-button"
          title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
        >
          üì§
        </button>
      </div>
    </div>
  }
</div>